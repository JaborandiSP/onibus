<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Horário do Ônibus — Jaborandi</title>

  <style>
    body {
      margin: 0;
      font-family: "Arial Rounded MT Bold", "Nunito", sans-serif;
      background: #fdfdfd;
      color: #222;
      text-align: center;
    }
    header {
      padding: 12px 0;
      background: #1b4f72;
      color: white;
      font-size: 22px;
      font-weight: bold;
    }
    #road-wrapper {
      position: relative;
      width: 100%;
      max-width: 1080px;
      margin: auto;
      overflow: hidden;
    }
    #bus {
      position: absolute;
      top: 210px;
      width: 16vw;
      max-width: 120px;
      transition: left 0.8s ease;
    }
    #bus.volta {
      transform: scaleX(-1);
    }
    #status {
      margin: 12px 0;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <header>Horário do Ônibus — Jaborandi ↔ Barretos</header>

  <div id="status">Carregando...</div>

  <div id="road-wrapper">
    <!-- Estrada com paisagem SVG -->
    <svg viewBox="0 0 1000 300" width="100%" xmlns="http://www.w3.org/2000/svg">
      <!-- Céu/colina/árvores (igual anterior) -->
      <rect width="1000" height="300" fill="#dff3ff"/>
      <path d="M0 170 Q150 100 300 170 T600 170 T900 170 T1200 170 V300 H0 Z" fill="#b7e4c7"/>
      <path d="M0 190 Q200 130 400 190 T800 190 T1200 190 V300 H0 Z" fill="#95d5b2"/>
      <rect x="0" y="200" width="1000" height="20" fill="#74c69d"/>
      <rect x="0" y="220" width="1000" height="60" fill="#2f2f3f"/>
      <line x1="0" y1="250" x2="1000" y2="250" stroke="#fff" stroke-width="6" stroke-dasharray="30,25"/>
      <!-- Pontos -->
      <text x="80" y="160" font-size="20" font-weight="bold" fill="#1b4332">Jaborandi</text>
      <text x="470" y="160" font-size="20" font-weight="bold" fill="#1b4332">Colina</text>
      <text x="860" y="160" font-size="20" font-weight="bold" fill="#1b4332">Barretos</text>
    </svg>

    <!-- Ônibus PNG -->
    <img id="bus" src="https://ai.jab.br/onibus/onibus.png" alt="Ônibus">
  </div>

  <script>
    // ===== HORÁRIOS =====
    const week = [
     {dir:'Barretos → Jaborandi', j:'03:50', c:'—',   b:'04:35'},
     {dir:'Jaborandi → Barretos', j:'04:45', c:'05:15', b:'05:45'},
     {dir:'Barretos → Jaborandi', j:'07:30', c:'08:00', b:'08:30'},
     {dir:'Jaborandi → Barretos', j:'12:00', c:'12:30', b:'13:00'},
     {dir:'Barretos → Jaborandi', j:'15:00', c:'15:30', b:'16:00'},
     {dir:'Jaborandi → Barretos', j:'16:00', c:'16:30', b:'17:00'},
     {dir:'Barretos → Jaborandi', j:'17:00', c:'17:30', b:'18:00'},
     {dir:'Jaborandi → Barretos', j:'18:00', c:'18:30', b:'19:00'},
     {dir:'Barretos → Jaborandi', j:'19:30', c:'20:00', b:'20:30'},
     {dir:'Jaborandi → Barretos', j:'20:30', c:'—',   b:'21:15'}
    ];
    
    const weekend = [
     {dir:'Barretos → Jaborandi', j:'03:50', c:'—',   b:'04:35'},
     {dir:'Jaborandi → Barretos', j:'04:45', c:'05:15', b:'05:45'},
     {dir:'Barretos → Jaborandi', j:'07:30', c:'08:00', b:'08:30'},
     {dir:'Jaborandi → Barretos', j:'15:00', c:'15:30', b:'16:00'},
     {dir:'Barretos → Jaborandi', j:'16:00', c:'16:30', b:'17:00'},
     {dir:'Jaborandi → Barretos', j:'18:00', c:'18:30', b:'19:00'},
     {dir:'Barretos → Jaborandi', j:'19:30', c:'20:00', b:'20:30'},
     {dir:'Jaborandi → Barretos', j:'20:30', c:'—',   b:'21:15'}
    ];

    const positions = { j:5, c:50, b:95 };

    function toMinutes(t) {
      if (!t || t === '—') return null;
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    function getTodaySchedule() {
      return ([0,6].includes(new Date().getDay()) ? weekend : week);
    }

    function updateBusPosition() {
      const sch = getTodaySchedule();
      const now = new Date();
      const m = now.getHours()*60 + now.getMinutes();
      let found = false;

      for (let trip of sch) {
        const j = toMinutes(trip.j);
        const c = toMinutes(trip.c);
        const b = toMinutes(trip.b);

        const stops = [
          {key:'j', time:j},
          {key:'c', time:c},
          {key:'b', time:b}
        ].filter(s => s.time !== null);

        for (let i=0; i<stops.length-1; i++) {
          const s0 = stops[i], s1 = stops[i+1];
          if (m >= s0.time && m <= s1.time) {
            const total = s1.time - s0.time;
            const passed = m - s0.time;
            const prog = passed/total;
            const startPos = positions[s0.key];
            const endPos = positions[s1.key];
            const busPos = startPos + (endPos - startPos)*prog;

            const bus = document.getElementById("bus");
            bus.style.left = busPos+"%";
            if (startPos > endPos) bus.classList.add("volta");
            else bus.classList.remove("volta");

            document.getElementById("status")
              .innerText = `Em rota: ${trip.dir} — agora ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;

            found = true;
            break;
          }
        }
        if (found) break;
      }
      if (!found) {
        document.getElementById("status").innerText = "Ônibus fora de serviço neste horário";
        document.getElementById("bus").style.display = "none";
      }
    }

    setInterval(updateBusPosition, 30000);
    updateBusPosition();

  </script>
</body>
</html>
