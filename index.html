<!DOCTYPE html>
<html lang="pt-br">
<head>
 <script async src="https://www.googletagmanager.com/gtag/js?id=G-09B2K29XXV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-09B2K29XXV');
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6493068451182223"
     crossorigin="anonymous"></script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Horário do Ônibus — Jaborandi</title>

  <style>
    body {
      margin: 0;
      font-family: "Arial Rounded MT Bold", "Nunito", sans-serif;
      background: #fdfdfd;
      color: #222;
      text-align: center;
    }
    header {
      padding: 12px 0;
      background: #1b4f72;
      color: white;
      font-size: 22px;
      font-weight: bold;
    }
    #road-wrapper {
      position: relative;
      width: 100%;
      max-width: 1080px;
      margin: auto;
      overflow: hidden;
    }
    #bus {
      position: absolute;
      top: 210px;
      width: 16vw;
      max-width: 120px;
      transition: left 0.8s ease;
    }
    #bus.volta {
      transform: scaleX(-1);
    }
    #status {
      margin: 12px 0;
      font-size: 18px;
      font-weight: bold;
    }
   .linha-ativa {
  background-color: #fff3cd;
  font-weight: bold;
  box-shadow: inset 4px 0 0 #f39c12;
}
  </style>
</head>
<body>

  <header>Horário do Ônibus — Jaborandi ↔ Barretos</header>

  <div id="status">Carregando...</div>
<div style="margin:15px 0;">

  <div id="clock" style="font-size:22px;font-weight:bold;">
    --:--
  </div>

  <div style="margin-top:10px;">
    <label>
      Testar horário:
      <input type="time" id="manualTime" style="font-size:16px;padding:4px;">
    </label>

    <button onclick="toggleManualTime()" 
            style="padding:6px 10px;margin-left:5px;">
      Ativar Teste
    </button>
  </div>

</div>

 <div id="road-wrapper">
    <!-- Estrada com paisagem SVG -->
    <svg viewBox="0 0 1000 300" width="100%" xmlns="http://www.w3.org/2000/svg">
      <!-- Céu/colina/árvores (igual anterior) -->
      <rect width="1000" height="300" fill="#dff3ff"/>
      <path d="M0 170 Q150 100 300 170 T600 170 T900 170 T1200 170 V300 H0 Z" fill="#b7e4c7"/>
      <path d="M0 190 Q200 130 400 190 T800 190 T1200 190 V300 H0 Z" fill="#95d5b2"/>
      <rect x="0" y="200" width="1000" height="20" fill="#74c69d"/>
      <rect x="0" y="220" width="1000" height="60" fill="#2f2f3f"/>
      <line x1="0" y1="250" x2="1000" y2="250" stroke="#fff" stroke-width="6" stroke-dasharray="30,25"/>
      <!-- Pontos -->
      <text x="80" y="160" font-size="20" font-weight="bold" fill="#1b4332">Jaborandi</text>
      <text x="470" y="160" font-size="20" font-weight="bold" fill="#1b4332">Colina</text>
      <text x="860" y="160" font-size="20" font-weight="bold" fill="#1b4332">Barretos</text>
    </svg>

    <!-- Ônibus PNG -->
    <img id="bus" src="https://ai.jab.br/onibus/onibus.png" alt="Ônibus">
  </div>
<div style="max-width:1000px;margin:25px auto;padding:10px;">

  <h2 style="margin-bottom:10px;">Tabela de Horários</h2>

<div style="max-width:1000px;margin:25px auto;padding:10px;">

  <h2 style="margin-bottom:10px;color:#1b4f72;">
    Barretos → Jaborandi
  </h2>

  <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:30px;">
    <thead style="background:#1b4f72;color:white;">
      <tr>
        <th style="padding:8px;">Barretos</th>
        <th>Colina</th>
        <th>Jaborandi</th>
      </tr>
    </thead>
    <tbody id="tbody-bj"></tbody>
  </table>

  <h2 style="margin-bottom:10px;color:#145a32;">
    Jaborandi → Barretos
  </h2>

  <table style="width:100%;border-collapse:collapse;font-size:14px;">
    <thead style="background:#145a32;color:white;">
      <tr>
        <th style="padding:8px;">Jaborandi</th>
        <th>Colina</th>
        <th>Barretos</th>
      </tr>
    </thead>
    <tbody id="tbody-jb"></tbody>
  </table>

</div>

</div>
  <script>
    // ===== HORÁRIOS =====
    const week = [
     {dir:'Barretos → Jaborandi', j:'04:35', c:'—',   b:'03:50'},
     {dir:'Jaborandi → Barretos', j:'04:45', c:'05:15', b:'05:45'},
     {dir:'Barretos → Jaborandi', j:'08:30', c:'08:00', b:'07:30'},
     {dir:'Jaborandi → Barretos', j:'12:00', c:'12:30', b:'13:00'},
     {dir:'Barretos → Jaborandi', j:'16:00', c:'15:30', b:'15:00'},
     {dir:'Jaborandi → Barretos', j:'16:00', c:'16:30', b:'17:00'},
     {dir:'Barretos → Jaborandi', j:'18:00', c:'17:30', b:'17:00'},
     {dir:'Jaborandi → Barretos', j:'18:00', c:'18:30', b:'19:00'},
     {dir:'Barretos → Jaborandi', j:'20:30', c:'20:00', b:'19:30'},
     {dir:'Jaborandi → Barretos', j:'20:30', c:'—',   b:'21:15'}
    ];
    
    const weekend = [
     {dir:'Barretos → Jaborandi', j:'04:35', c:'—',   b:'03:50'},
     {dir:'Jaborandi → Barretos', j:'04:45', c:'05:15', b:'05:45'},
     {dir:'Barretos → Jaborandi', j:'08:30', c:'08:00', b:'07:30'},
     {dir:'Jaborandi → Barretos', j:'15:00', c:'15:30', b:'16:00'},
     {dir:'Barretos → Jaborandi', j:'17:00', c:'16:30', b:'16:00'},
     {dir:'Jaborandi → Barretos', j:'18:00', c:'18:30', b:'19:00'},
     {dir:'Barretos → Jaborandi', j:'20:30', c:'20:00', b:'19:30'},
     {dir:'Jaborandi → Barretos', j:'20:30', c:'—',   b:'21:15'}
    ];

    const positions = { j:7, c:44, b:80 };

    function toMinutes(t) {
      if (!t || t === '—') return null;
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    function getTodaySchedule() {
      return ([0,6].includes(new Date().getDay()) ? weekend : week);
    }

let useManualTime = false;

function getCurrentMinutes() {

  if (useManualTime) {
    const val = document.getElementById("manualTime").value;
    if (!val) return null;
    const [h,m] = val.split(":").map(Number);
    return h*60 + m;
  }

  const now = new Date();
  return now.getHours()*60 + now.getMinutes();
}

function updateClockDisplay() {
  let text;

  if (useManualTime) {
    text = document.getElementById("manualTime").value || "--:--";
  } else {
    const now = new Date();
    text = now.getHours().toString().padStart(2,'0') + ":" +
           now.getMinutes().toString().padStart(2,'0');
  }

  document.getElementById("clock").innerText = text;
}

function toggleManualTime() {
  useManualTime = !useManualTime;
  updateBusPosition();
}

function updateBusPosition() {

  updateClockDisplay();

  const schedule = getTodaySchedule();
  const currentMinutes = getCurrentMinutes();
  if (currentMinutes === null) return;

  let found = false;
  let lastStop = null;

  for (let trip of schedule) {

    const j = toMinutes(trip.j);
    const c = toMinutes(trip.c);
    const b = toMinutes(trip.b);

    let stops;

    if (trip.dir.includes("Barretos → Jaborandi")) {
      stops = [
        {key:'b', time:b},
        {key:'c', time:c},
        {key:'j', time:j}
      ];
    } else {
      stops = [
        {key:'j', time:j},
        {key:'c', time:c},
        {key:'b', time:b}
      ];
    }

    stops = stops.filter(s => s.time !== null);

    for (let i = 0; i < stops.length - 1; i++) {

      const start = stops[i];
      const end = stops[i+1];

      if (currentMinutes >= start.time && currentMinutes <= end.time) {

        const total = end.time - start.time;
        const passed = currentMinutes - start.time;
        const progress = passed / total;

        const startPos = positions[start.key];
        const endPos = positions[end.key];
        const busPos = startPos + (endPos - startPos) * progress;

        const bus = document.getElementById("bus");
        bus.style.display = "block";
        bus.style.left = busPos + "%";

        // Espelhamento correto
        if (trip.dir.includes("Jaborandi → Barretos")) {
          bus.classList.add("volta");
        } else {
          bus.classList.remove("volta");
        }

        document.getElementById("status").innerText =
          "Em rota: " + trip.dir;

        found = true;
        break;
      }
    }

    // Guardar último ponto já passado
    for (let stop of stops) {
      if (currentMinutes >= stop.time) {
        lastStop = stop;
      }
    }

    if (found) break;
  }

  const bus = document.getElementById("bus");

  if (!found) {

if (lastStop) {

  bus.style.display = "block";
  bus.style.left = positions[lastStop.key] + "%";

  // Descobrir qual é a próxima viagem
  let nextTrip = null;

  for (let trip of schedule) {
    const times = [trip.j, trip.c, trip.b]
      .map(t => toMinutes(t))
      .filter(t => t !== null);

    if (times.some(t => t > currentMinutes)) {
      nextTrip = trip;
      break;
    }
  }

  // Se existir próxima viagem, já virar para ela
  if (nextTrip) {
    if (nextTrip.dir.includes("Jaborandi → Barretos")) {
      bus.classList.add("volta");
    } else {
      bus.classList.remove("volta");
    }
  }

  document.getElementById("status").innerText =
    "Última parada: " +
    (lastStop.key === 'j' ? "Jaborandi" :
     lastStop.key === 'c' ? "Colina" : "Barretos");
} else {
  // Antes do primeiro horário do dia
  bus.style.display = "block";

  // Pegar a primeira viagem do dia
  const firstTrip = schedule[0];

  if (firstTrip.dir.includes("Barretos → Jaborandi")) {
    bus.style.left = positions.b + "%";
    bus.classList.remove("volta");
  } else {
    bus.style.left = positions.j + "%";
    bus.classList.add("volta");
  }

  document.getElementById("status").innerText =
    "Aguardando primeira saída do dia";
}
  }
}

function renderScheduleTable() {

  const schedule = getTodaySchedule();
  const tbodyBJ = document.getElementById("tbody-bj");
  const tbodyJB = document.getElementById("tbody-jb");

  tbodyBJ.innerHTML = "";
  tbodyJB.innerHTML = "";

  const currentMinutes = getCurrentMinutes();

  schedule.forEach(trip => {

    const row = document.createElement("tr");
    row.style.borderBottom = "1px solid #ccc";

    // Detectar horário início/fim
    const times = [trip.j, trip.c, trip.b]
      .map(t => toMinutes(t))
      .filter(t => t !== null);

    let isActive = false;

    if (times.length >= 2) {
      const start = Math.min(...times);
      const end = Math.max(...times);

      if (currentMinutes >= start && currentMinutes <= end) {
        isActive = true;
      }
    }

    if (isActive) {
      row.classList.add("linha-ativa");
    }

    // Preencher conforme direção
    if (trip.dir.includes("Barretos → Jaborandi")) {

      row.innerHTML = `
        <td style="padding:6px;">${trip.b}</td>
        <td style="padding:6px;">${trip.c}</td>
        <td style="padding:6px;">${trip.j}</td>
      `;

      tbodyBJ.appendChild(row);

    } else {

      row.innerHTML = `
        <td style="padding:6px;">${trip.j}</td>
        <td style="padding:6px;">${trip.c}</td>
        <td style="padding:6px;">${trip.b}</td>
      `;

      tbodyJB.appendChild(row);
    }

  });
}

setInterval(() => {
  updateBusPosition();
  renderScheduleTable();
}, 1000);

updateBusPosition();
renderScheduleTable();
  </script>
</body>
</html>
